<div class="sub-record-detail-container">
  <!-- Left Side: Gynecology Sub-Record and Consultation Details -->
  <div class="sub-record-main-content" 
       [class.sub-record-main-content-full]="selectedConsultationId() || selectedEditConsultationId() || showCreateConsultationForm()">
    <div *ngIf="gynecologySubRecord; else loading">
      <!-- Gynecology Sub-Record Details (always shown) -->
      <div class="sub-record-section">
        <h2 class="sub-record-section-header">
          Gynecology Sub-Record Details
        </h2>
        <div class="sub-record-detail-compact-grid">
          <!-- Row 1: IDs and Basic Info -->
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">ID</span>
            <span class="sub-record-detail-value">{{ gynecologySubRecord.id }}</span>
          </div>
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Medical Record ID</span>
            <span class="sub-record-detail-value">{{ gynecologySubRecord.medicalRecordId }}</span>
          </div>
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Work</span>
            <span class="sub-record-detail-value" [class.sub-record-detail-value-empty]="!gynecologySubRecord.work">
              {{ gynecologySubRecord.work || 'None' }}
            </span>
          </div>
          
          <!-- Row 2: Personal Info -->
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Civil State</span>
            <span class="sub-record-detail-value" [class.sub-record-detail-value-empty]="!gynecologySubRecord.civilState">
              {{ gynecologySubRecord.civilState || 'None' }}
            </span>
          </div>
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Hormone Status</span>
            <span class="sub-record-detail-value">{{ gynecologySubRecord.hormoneStatus }}</span>
          </div>
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Menopause Date</span>
            <span class="sub-record-detail-value" [class.sub-record-detail-value-empty]="!gynecologySubRecord.menopause">
              {{ gynecologySubRecord.menopause ? (gynecologySubRecord.menopause | date:'yyyy-MM-dd') : 'None' }}
            </span>
          </div>
          
          <!-- Row 3: Medical Conditions -->
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Dysmenorrhea</span>
            <span class="sub-record-detail-value">{{ gynecologySubRecord.dysmenorrhea ? 'Yes' : 'No' }}</span>
          </div>
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Menorrhagia</span>
            <span class="sub-record-detail-value">{{ gynecologySubRecord.menorrhagia ? 'Yes' : 'No' }}</span>
          </div>
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Metrorrhagia</span>
            <span class="sub-record-detail-value">{{ gynecologySubRecord.metrorrhagia ? 'Yes' : 'No' }}</span>
          </div>
          
          <!-- Row 4: Period Info -->
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Period Min (days)</span>
            <span class="sub-record-detail-value">{{ gynecologySubRecord.periodMin }}</span>
          </div>
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Period Max (days)</span>
            <span class="sub-record-detail-value">{{ gynecologySubRecord.periodMax }}</span>
          </div>
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Record Date</span>
            <span class="sub-record-detail-value" [class.sub-record-detail-value-empty]="!gynecologySubRecord.date">
              {{ gynecologySubRecord.date ? (gynecologySubRecord.date | date:'yyyy-MM-dd') : 'None' }}
            </span>
          </div>
          
          <!-- Row 5: Background Date -->
          <div class="sub-record-detail-item sub-record-detail-span-2">
            <span class="sub-record-detail-label">Background Date</span>
            <span class="sub-record-detail-value" [class.sub-record-detail-value-empty]="!gynecologySubRecord.background">
              {{ gynecologySubRecord.background ? (gynecologySubRecord.background | date:'yyyy-MM-dd') : 'None' }}
            </span>
          </div>
        </div>
      </div>

      <!-- Consultation Details (shown when a consultation is selected) -->
      <div *ngIf="selectedConsultationId()" class="sub-record-section">
        <h2 class="sub-record-section-header">
          <svg xmlns="http://www.w3.org/2000/svg" class="sub-record-section-icon" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
          </svg>
          Consultation Details
        </h2>
        <div class="consultation-detail-container">
          <div class="consultation-detail-content">
            <app-consultation-detail 
              [consultationId]="selectedConsultationId()!" 
              (closeDetail)="setSelectedConsultationId(null)">
            </app-consultation-detail>
          </div>
        </div>
      </div>

      <!-- Consultation Edit Form -->
      <div *ngIf="selectedEditConsultationId()" class="sub-record-section">
        <h2 class="sub-record-section-header">
          <svg xmlns="http://www.w3.org/2000/svg" class="sub-record-section-icon" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" clip-rule="evenodd" />
          </svg>
          Edit Consultation
        </h2>
        <div class="consultation-detail-container">
          <app-consultation-form
            [consultationId]="selectedEditConsultationId()!"
            (formSubmitted)="setSelectedEditConsultationId(null)"
          />
        </div>
      </div>

      <!-- Create New Consultation Form -->
      <div *ngIf="showCreateConsultationForm()" class="sub-record-section">
        <h2 class="sub-record-section-header">
          <svg xmlns="http://www.w3.org/2000/svg" class="sub-record-section-icon" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
          </svg>
          Add New Consultation
        </h2>
        <div class="consultation-detail-container">
          <app-consultation-form
            [consultationId]="null"
            [gynecologyRecordId]="gynecologySubRecord.id"
            (formSubmitted)="onCreateConsultationFormSubmitted()"
            [type]="'gynecology'"
          />
        </div>
      </div>
    </div>
    
    <ng-template #loading>
      <div class="loading-container">
        <p class="loading-text">Loading gynecology sub-record...</p>
      </div>
    </ng-template>
  </div>

  <!-- Right Side: Consultation List -->
  <div class="sub-record-sidebar" *ngIf="!selectedConsultationId() && !selectedEditConsultationId() && !showCreateConsultationForm()">
    <div *ngIf="gynecologySubRecord; else loadingSidebar">
      <div class="sub-record-section">
        <div class="consultation-list-header">
          <h2 class="sub-record-section-header">
            <svg xmlns="http://www.w3.org/2000/svg" class="sub-record-section-icon" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
            </svg>
            Consultations
          </h2>
          <button type="button" class="add-consultation-button" (click)="onCreateConsultation()" title="Add New Consultation">
            <svg xmlns="http://www.w3.org/2000/svg" class="add-consultation-icon" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
        <app-consultation-list 
          [consultations]="gynecologySubRecord.consultations" 
          [setSelectedConsultationId]="setSelectedConsultationId.bind(this)" 
          [setSelectedEditConsultationId]="setSelectedEditConsultationId.bind(this)">
        </app-consultation-list>
      </div>
    </div>
    
    <ng-template #loadingSidebar>
      <div class="loading-container">
        <p class="loading-text">Loading consultations...</p>
      </div>
    </ng-template>
    
    <div *ngIf="error" class="error-container">
      <p class="error-text">{{ error }}</p>
    </div>
  </div>
</div>