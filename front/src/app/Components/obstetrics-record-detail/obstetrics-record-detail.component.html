<div class="sub-record-detail-container">
  <!-- Left Side: Obstetrics Record and Consultation Details -->
  <div class="sub-record-main-content" 
       [class.sub-record-main-content-full]="selectedConsultationId() || selectedEditConsultationId() || showCreateConsultationForm()">
    <div *ngIf="obstetricsRecord; else loading">
      <!-- Obstetrics Record Details (always shown) -->
      <div class="sub-record-section">
        <h2 class="sub-record-section-header">
          Obstetrics Record Details
        </h2>
        <div class="sub-record-detail-compact-grid">
          <!-- Row 1: IDs and Basic Info -->
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">ID</span>
            <span class="sub-record-detail-value">{{ obstetricsRecord.id }}</span>
          </div>
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Medical Record ID</span>
            <span class="sub-record-detail-value">{{ obstetricsRecord.medicalRecordId }}</span>
          </div>
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Number of Fetuses</span>
            <span class="sub-record-detail-value">{{ obstetricsRecord.nfoetus }}</span>
          </div>
          
          <!-- Row 2: Conception Info -->
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Conception Type</span>
            <span class="sub-record-detail-value">{{ obstetricsRecord.conceptionType }}</span>
          </div>
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Conception Date</span>
            <span class="sub-record-detail-value" [class.sub-record-detail-value-empty]="!obstetricsRecord.conceptionDate">
              {{ obstetricsRecord.conceptionDate ? (obstetricsRecord.conceptionDate | date:'yyyy-MM-dd') : 'None' }}
            </span>
          </div>
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Last Menstrual Period</span>
            <span class="sub-record-detail-value" [class.sub-record-detail-value-empty]="!obstetricsRecord.ddr">
              {{ obstetricsRecord.ddr ? (obstetricsRecord.ddr | date:'yyyy-MM-dd') : 'None' }}
            </span>
          </div>
          
          <!-- Row 3: Record Date and Comment -->
          <div class="sub-record-detail-item">
            <span class="sub-record-detail-label">Record Date</span>
            <span class="sub-record-detail-value" [class.sub-record-detail-value-empty]="!obstetricsRecord.date">
              {{ obstetricsRecord.date ? (obstetricsRecord.date | date:'yyyy-MM-dd') : 'None' }}
            </span>
          </div>
          <div class="sub-record-detail-item sub-record-detail-span-2">
            <span class="sub-record-detail-label">Comment</span>
            <span class="sub-record-detail-value" [class.sub-record-detail-value-empty]="!obstetricsRecord.comment">
              {{ obstetricsRecord.comment || 'None' }}
            </span>
          </div>
        </div>
      </div>

      <!-- Consultation Details (shown when a consultation is selected) -->
      <div *ngIf="selectedConsultationId()" class="sub-record-section">
        <h2 class="sub-record-section-header">
          <svg xmlns="http://www.w3.org/2000/svg" class="sub-record-section-icon" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
          </svg>
          Consultation Details
        </h2>
        <div class="consultation-detail-container">
          <div class="consultation-detail-content">
            <app-consultation-detail 
              [consultationId]="selectedConsultationId()!" 
              (closeDetail)="setSelectedConsultationId(null)">
            </app-consultation-detail>
          </div>
        </div>
      </div>

      <!-- Consultation Edit Form -->
      <div *ngIf="selectedEditConsultationId()" class="sub-record-section">
        <h2 class="sub-record-section-header">
          <svg xmlns="http://www.w3.org/2000/svg" class="sub-record-section-icon" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" clip-rule="evenodd" />
          </svg>
          Edit Consultation
        </h2>
        <div class="consultation-detail-container">
          
            <app-consultation-form
              [consultationId]="selectedEditConsultationId()!"
              (formSubmitted)="setSelectedEditConsultationId(null)"
            />
        </div>
      </div>

      <!-- Create New Consultation Form -->
      <div *ngIf="showCreateConsultationForm()" class="sub-record-section">
        <h2 class="sub-record-section-header">
          <svg xmlns="http://www.w3.org/2000/svg" class="sub-record-section-icon" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
          </svg>
          Add New Consultation
        </h2>
        <div class="consultation-detail-container">
          <app-consultation-form
            [consultationId]="null"
            [obstetricsRecordId]="obstetricsRecord.id"
            (formSubmitted)="onCreateConsultationFormSubmitted()"
            [type]="'obstetrics'"
          />
        </div>
      </div>
    </div>
    
    <ng-template #loading>
      <div class="loading-container">
        <p class="loading-text">Loading obstetrics record...</p>
      </div>
    </ng-template>
  </div>

  <!-- Right Side: Consultation List -->
  <div class="sub-record-sidebar" *ngIf="!selectedConsultationId() && !selectedEditConsultationId() && !showCreateConsultationForm()">
    <div *ngIf="obstetricsRecord; else loadingSidebar">
      <div class="sub-record-section">
        <div class="consultation-list-header">
          <h2 class="sub-record-section-header">
            <svg xmlns="http://www.w3.org/2000/svg" class="sub-record-section-icon" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
            </svg>
            Consultations
          </h2>
          <button type="button" class="add-consultation-button" (click)="onCreateConsultation()" title="Add New Consultation">
            <svg xmlns="http://www.w3.org/2000/svg" class="add-consultation-icon" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
        <app-consultation-list 
          [consultations]="obstetricsRecord.consultations" 
          [setSelectedConsultationId]="setSelectedConsultationId.bind(this)" 
          [setSelectedEditConsultationId]="setSelectedEditConsultationId.bind(this)">
        </app-consultation-list>
      </div>
    </div>
    
    <ng-template #loadingSidebar>
      <div class="loading-container">
        <p class="loading-text">Loading consultations...</p>
      </div>
    </ng-template>
    
    <div *ngIf="error" class="error-container">
      <p class="error-text">{{ error }}</p>
    </div>
  </div>
</div>